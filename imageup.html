<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Soft Glow Upscaler</title>
<style>

:root {
  --bg: #121212;
  --card: #1e1e1e;
  --text: #e0e0e0;
  --accent: #00e676;
  --accent-hover: #00c853;
}

body {
  background: var(--bg);
  color: var(--text);
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 6px;
  margin: 0;
}

.container {
  max-width: 100%;
  width: 99%;
  background: var(--card);
  padding: 0.6rem;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
  border: 1px solid #333;
}

h1 {
  text-align: center;
  margin-top: 0;
  font-weight: 600;
}

.main-layout {
  display: flex;
  gap: 20px;
  margin-top: 20px;
}

.sidebar {
  flex: 0 0 350px;
  min-width: 300px;
  display: flex;
  flex-direction: column;
}

.preview-panel {
  flex: 1;
  min-width: 400px;
}

.controls {
  display: flex;
  flex-direction: column;
  gap: 20px;
  margin: 0 0 20px 0;
  padding: 20px;
  background: #252525;
  border-radius: 8px;
  border: 1px solid #333;
}

.control-group {
  display: flex;
  flex-direction: column;
}

label {
  margin-bottom: 8px;
  font-weight: 500;
  font-size: 0.9rem;
  color: #bbb;
}

input[type="range"] {
  width: 100%;
  cursor: pointer;
  accent-color: var(--accent);
}

small {
  color: #777;
  font-size: 0.8rem;
  margin-top: 4px;
}

.buttons {
  display: flex;
  gap: 15px;
  justify-content: flex-start;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.btn {
  padding: 12px 24px;
  border: none;
  border-radius: 6px;
  font-weight: 600;
  font-size: 1rem;
  cursor: pointer;
  transition: all 0.2s ease;
  text-decoration: none;
  display: inline-block;
  text-align: center;
}

.btn-primary {
  background: var(--accent);
  color: #000;
}

.btn-primary:hover {
  background: var(--accent-hover);
}

.btn-primary:disabled {
  background: #444;
  color: #777;
  cursor: not-allowed;
}

.btn-success {
  background: #198754;
  color: white;
  display: none;
}

.btn-success:hover {
  background: #157347;
}

.upload-area {
  border: 2px dashed #555;
  padding: 20px;
  text-align: center;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.2s;
  background: #222;
  margin-bottom: 20px;
}

.upload-area:hover {
  border-color: var(--accent);
  background: #2a2a2a;
}

.preview-controls {
  display: flex;
  justify-content: flex-end;
  margin-bottom: 10px;
}

.canvas-wrapper {
  overflow: auto;
  max-height: 80vh;
  border: 1px solid #333;
  background: #000;
  display: block;
  position: relative;
  text-align: center;
}

.canvas-wrapper.fit-to-screen {
  overflow: hidden;
  max-height: none;
  height: auto;
}

.canvas-wrapper.fit-to-screen canvas {
  max-width: 100%;
  max-height: calc(100vh - 250px);
  width: auto !important;
  height: auto !important;
  object-fit: contain;
}

canvas {
  max-width: none;
  display: inline-block;
  vertical-align: top;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
}

.status {
  text-align: center;
  color: #888;
  margin-top: 15px;
  font-family: monospace;
}

select {
  padding: 8px;
  background: #333;
  color: white;
  border: 1px solid #555;
  border-radius: 4px;
  font-size: 1rem;
}

</style>
  </head>
  <body>
    <div class="container">
      <div class="main-layout">
        <div class="sidebar">
          <div class="upload-area" onclick="document.getElementById('fileIn').click()" id="dropZone">
            <p style="margin: 0; font-size: 0.95rem;"><strong>Click to browse</strong> or drag and drop image</p>
            <input type="file" id="fileIn" accept="image/*" style="display:none">
          </div>
          <div class="controls">
            <div class="control-group">
              <label>1. Base Sharpen: <span id="sharpVal">0.8</span></label>
              <input type="range" id="sharpRange" min="0" max="3" value="0.8" step="0.1">
              <small>Define edges before blurring.</small>
            </div>
            <div class="control-group">
              <label>2. Top Layer Blur: <span id="blurVal">15</span>px</label>
              <input type="range" id="blurRange" min="0" max="40" value="15" step="1">
              <small>Smoothness of the overlay.</small>
            </div>
            <div class="control-group">
              <label>3. Top Opacity: <span id="opacityVal">40</span>%</label>
              <input type="range" id="opacityRange" min="0" max="100" value="40" step="5">
              <small>Visibility of the soft layer.</small>
            </div>
            <div class="control-group">
              <label style="color:white">4. Final Contrast: <span id="contrastVal">110</span>%</label>
              <input type="range" id="contrastRange" min="100" max="200" value="110" step="5">
              <small>Restores punch after blurring.</small>
            </div>
            <div class="control-group">
              <label>5. Scale Factor</label>
              <select id="scaleSelect">
                <option value="2">2x Upscale</option>
                <option value="3">3x Upscale</option>
                <option value="4">4x Upscale</option>
              </select>
            </div>
          </div>
          <div class="buttons">
            <button id="processBtn" class="btn btn-primary" disabled>Process Image</button>
            <a id="downloadLink" class="btn btn-success">Download Image</a>
          </div>
          <p style="color: #606060;">&copy; Johnny Heggelund</p>
        </div>
        <div class="preview-panel">
          <div class="preview-controls">
            <button id="fitScreenBtn" class="btn btn-primary">Fit to Screen</button>
          </div>
          <div class="status" id="status">Waiting for image...</div>
          <div class="canvas-wrapper" id="canvasWrapper">
            <canvas id="canvas"></canvas>
          </div>
        </div>
      </div>
    </div>
<script>

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const fileIn = document.getElementById('fileIn');
const dropZone = document.getElementById('dropZone');
const processBtn = document.getElementById('processBtn');
const downloadLink = document.getElementById('downloadLink');
const status = document.getElementById('status');
const sharpRange = document.getElementById('sharpRange');
const blurRange = document.getElementById('blurRange');
const opacityRange = document.getElementById('opacityRange');
const contrastRange = document.getElementById('contrastRange');
const canvasWrapper = document.getElementById('canvasWrapper');
const fitScreenBtn = document.getElementById('fitScreenBtn');
let originalImg = new Image();
let originalFileName = "image";
let isLoaded = false;
let isFitToScreen = false;
sharpRange.oninput = function() {
  document.getElementById('sharpVal').innerText = this.value;
}
blurRange.oninput = function() {
  document.getElementById('blurVal').innerText = this.value;
}
opacityRange.oninput = function() {
  document.getElementById('opacityVal').innerText = this.value;
}
contrastRange.oninput = function() {
  document.getElementById('contrastVal').innerText = this.value;
}
fitScreenBtn.addEventListener('click', () => {
  isFitToScreen = !isFitToScreen;
  canvasWrapper.classList.toggle('fit-to-screen', isFitToScreen);
  fitScreenBtn.textContent = isFitToScreen ? 'Show Actual Size' : 'Fit to Screen';
});

function handleFile(file) {
  if (!file) return;
  originalFileName = file.name.split('.').slice(0, -1).join('.');
  const reader = new FileReader();
  reader.onload = (e) => {
    originalImg.onload = () => {
      canvas.width = originalImg.width;
      canvas.height = originalImg.height;
      canvas.style.width = "";
      canvas.style.height = "";
      ctx.drawImage(originalImg, 0, 0);
      isLoaded = true;
      processBtn.disabled = false;
      status.innerText = `Loaded: ${file.name} (${originalImg.width}x${originalImg.height}px)`;
      downloadLink.style.display = 'none';
      if (isFitToScreen) {
        fitScreenBtn.click();
      }
    }
    originalImg.src = e.target.result;
  };
  reader.readAsDataURL(file);
}
fileIn.addEventListener('change', e => handleFile(e.target.files[0]));
dropZone.addEventListener('dragover', e => {
  e.preventDefault();
  dropZone.style.borderColor = '#00e676';
  dropZone.style.background = '#2a2a2a';
});
dropZone.addEventListener('dragleave', e => {
  e.preventDefault();
  dropZone.style.borderColor = '#555';
  dropZone.style.background = '#222';
});
dropZone.addEventListener('drop', e => {
  e.preventDefault();
  dropZone.style.borderColor = '#555';
  dropZone.style.background = '#222';
  handleFile(e.dataTransfer.files[0]);
});
processBtn.addEventListener('click', () => {
  if (!isLoaded) return;
  status.innerText = "Processing... (Mixing Layers + Contrast)";
  processBtn.disabled = true;
  downloadLink.style.display = 'none';
  setTimeout(() => {
    const scale = parseInt(document.getElementById('scaleSelect').value);
    const sharpAmt = parseFloat(sharpRange.value);
    const blurRadius = parseInt(blurRange.value);
    const layerOpacity = parseInt(opacityRange.value) / 100;
    const contrastVal = parseInt(contrastRange.value);
    const targetW = Math.round(originalImg.width * scale);
    const targetH = Math.round(originalImg.height * scale);
    const bufferCanvas = document.createElement('canvas');
    bufferCanvas.width = targetW;
    bufferCanvas.height = targetH;
    const bCtx = bufferCanvas.getContext('2d');
    bCtx.imageSmoothingEnabled = true;
    bCtx.imageSmoothingQuality = 'high';
    bCtx.drawImage(originalImg, 0, 0, targetW, targetH);
    if (sharpAmt > 0) {
      const imgData = bCtx.getImageData(0, 0, targetW, targetH);
      const sharpenedData = applySharpenKernel(imgData, targetW, targetH, sharpAmt);
      bCtx.putImageData(sharpenedData, 0, 0);
    }
    bCtx.save();
    bCtx.globalAlpha = layerOpacity;
    bCtx.filter = `blur(${blurRadius}px)`;
    bCtx.drawImage(originalImg, 0, 0, targetW, targetH);
    bCtx.restore();
    canvas.width = targetW;
    canvas.height = targetH;
    ctx.filter = `contrast(${contrastVal}%)`;
    ctx.drawImage(bufferCanvas, 0, 0);
    ctx.filter = 'none';
    const newFileName = `${originalFileName}_SoftGlow_x${scale}.png`;
    downloadLink.href = canvas.toDataURL("image/png");
    downloadLink.download = newFileName;
    downloadLink.style.display = "inline-block";
    processBtn.disabled = false;
    status.innerText = "âœ… Done! Layers blended & corrected.";
  }, 50);
});

function applySharpenKernel(imgData, w, h, amount) {
  const src = imgData.data;
  const output = new ImageData(w, h);
  const dst = output.data;
  for (let y = 1; y < h - 1; y++) {
    for (let x = 1; x < w - 1; x++) {
      const idx = (y * w + x) * 4;
      for (let c = 0; c < 3; c++) {
        const val = src[idx + c];
        const top = src[idx - w * 4 + c];
        const bottom = src[idx + w * 4 + c];
        const left = src[idx - 4 + c];
        const right = src[idx + 4 + c];
        const edge = (4 * val) - top - bottom - left - right;
        dst[idx + c] = Math.min(255, Math.max(0, val + (edge * amount)));
      }
      dst[idx + 3] = 255;
    }
  }
  return output;
}

</script>
  </body>
</html>